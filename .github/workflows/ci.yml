name: Static Website Validation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  schedule:
    # Run weekly on Sundays at 2 AM UTC to catch any issues
    - cron: '0 2 * * 0'

jobs:
  validate:
    runs-on: ubuntu-latest
    name: Static Website Validation
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Check HTML structure
      run: |
        echo "üîç Checking HTML structure..."
        for html_file in $(find . -name "*.html" -type f); do
          echo "Validating $html_file..."
          
          # Check if file has basic HTML structure
          if grep -q "<!DOCTYPE html>" "$html_file"; then
            echo "  ‚úÖ Has DOCTYPE declaration"
          else
            echo "  ‚ö†Ô∏è  Missing DOCTYPE declaration"
          fi
          
          if grep -q "<html" "$html_file"; then
            echo "  ‚úÖ Has html tag"
          else
            echo "  ‚ö†Ô∏è  Missing html tag"
          fi
          
          if grep -q "<head" "$html_file"; then
            echo "  ‚úÖ Has head tag"
          else
            echo "  ‚ö†Ô∏è  Missing head tag"
          fi
          
          if grep -q "<title" "$html_file"; then
            echo "  ‚úÖ Has title tag"
          else
            echo "  ‚ö†Ô∏è  Missing title tag"
          fi
          
          if grep -q "<body" "$html_file"; then
            echo "  ‚úÖ Has body tag"
          else
            echo "  ‚ö†Ô∏è  Missing body tag"
          fi
          
          echo ""
        done
        
    - name: Check file structure
      run: |
        echo "üìÅ Checking file structure..."
        echo "HTML files found:"
        find . -name "*.html" -type f | wc -l
        find . -name "*.html" -type f
        
        echo "CSS files found:"
        find . -name "*.css" -type f | wc -l
        find . -name "*.css" -type f
        
        echo "JavaScript files found:"
        find . -name "*.js" -type f | wc -l
        find . -name "*.js" -type f
        
        echo "Image files found:"
        find . -name "*.png" -o -name "*.jpg" -o -name "*.jpeg" -o -name "*.gif" -o -name "*.svg" -type f | wc -l
        find . -name "*.png" -o -name "*.jpg" -o -name "*.jpeg" -o -name "*.gif" -o -name "*.svg" -type f
        
    - name: Check file sizes
      run: |
        echo "üìè Checking file sizes..."
        echo "Large files (>1MB):"
        find . -type f -size +1M -not -path "./.git/*" | head -10
        
        echo "Total project size:"
        du -sh . --exclude=.git
        
        echo "File size breakdown:"
        echo "HTML files:"
        find . -name "*.html" -type f -exec ls -lh {} \;
        echo "CSS files:"
        find . -name "*.css" -type f -exec ls -lh {} \;
        echo "JS files:"
        find . -name "*.js" -type f -exec ls -lh {} \;
        
    - name: Validate CSS syntax
      run: |
        echo "üé® Checking CSS files..."
        for css_file in $(find . -name "*.css" -type f); do
          echo "Checking $css_file..."
          if [ -s "$css_file" ]; then
            echo "  ‚úÖ CSS file exists and has content"
            # Basic CSS validation - check for common syntax issues
            if grep -q "{" "$css_file" && grep -q "}" "$css_file"; then
              echo "  ‚úÖ Has opening and closing braces"
            else
              echo "  ‚ö†Ô∏è  Missing braces"
            fi
          else
            echo "  ‚ùå CSS file is empty"
          fi
        done
        
    - name: Check for broken internal links
      run: |
        echo "üîó Checking internal links..."
        for html_file in $(find . -name "*.html" -type f); do
          echo "Checking links in $html_file..."
          
          # Extract href attributes and check if files exist
          grep -o 'href="[^"]*"' "$html_file" | sed 's/href="//;s/"//' | while read link; do
            if [[ "$link" == ./* ]] || [[ "$link" == ../* ]]; then
              if [ -f "$(dirname "$html_file")/$link" ]; then
                echo "  ‚úÖ Link $link exists"
              else
                echo "  ‚ö†Ô∏è  Broken link: $link"
              fi
            fi
          done
        done
        
    - name: Test Summary
      run: |
        echo "‚úÖ Static website validation completed!"
        echo "üìã Check the Actions tab for detailed results"
        echo "üåê This is a pure static HTML/CSS/JS website - no build process needed"
        echo "üöÄ Ready for deployment to GitHub Pages or any static hosting service"
